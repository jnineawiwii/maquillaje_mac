{% extends "base.html" %}

{% block content %}
<div class="search-results-container">
    <h2>Resultados de búsqueda</h2>
    
    {% if query %}
        <p class="search-info">
            {% if search_count > 0 %}
                Se encontraron {{ search_count }} resultados para "{{ query }}"
            {% else %}
                No se encontraron resultados para "{{ query }}"
            {% endif %}
        </p>
    {% endif %}
    
    {% if products %}
    <div class="products-grid">
        {% for product in products %}
        <div class="product-card">
            <img src="{{ product.image_url }}" alt="{{ product.name }}" onerror="this.src='https://via.placeholder.com/200x200/e0e0e0/666666?text=Imagen+No+Disponible'">
            <div class="product-info">
                <h3>{{ product.name }}</h3>
                <p class="product-description">{{ product.description|truncate(100) }}</p>
                <p class="product-price">${{ "%.2f"|format(product.price) }}</p>
                <p class="product-category">{{ product.category }}</p>
                
                {% if current_user.is_authenticated %}
                <button class="add-to-cart-btn" data-product-id="{{ product.id }}">
                    <i class="fas fa-shopping-cart"></i> Añadir al carrito
                </button>
                {% else %}
                <a href="{{ url_for('login') }}" class="btn-primary">Iniciar sesión para comprar</a>
                {% endif %}
                
                <a href="{{ url_for('product_detail', product_id=product.id) }}" class="view-details">Ver detalles</a>
            </div>
        </div>
        {% endfor %}
    </div>
    {% elif query %}
    <div class="no-results">
        <p>Intenta con otros términos de búsqueda o explora nuestras categorías:</p>
        <div class="categories">
            <a href="{{ url_for('products', category='labios') }}" class="category-btn">Labios</a>
            <a href="{{ url_for('products', category='ojos') }}" class="category-btn">Ojos</a>
            <a href="{{ url_for('products', category='rostro') }}" class="category-btn">Rostro</a>
        </div>
    </div>
    {% endif %}
</div>

<style>
    .search-results-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
    }
    
    .search-info {
        margin-bottom: 20px;
        font-size: 16px;
        color: #666;
    }
    
    .products-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 20px;
        margin-top: 20px;
    }
    
    .product-card {
        border: 1px solid #eee;
        border-radius: 8px;
        overflow: hidden;
        transition: transform 0.3s, box-shadow 0.3s;
    }
    
    .product-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .product-card img {
        width: 100%;
        height: 200px;
        object-fit: cover;
    }
    
    .product-info {
        padding: 15px;
    }
    
    .product-info h3 {
        margin-bottom: 10px;
        color: #2c3e50;
    }
    
    .product-description {
        color: #666;
        font-size: 14px;
        margin-bottom: 10px;
    }
    
    .product-price {
        font-weight: bold;
        color: #120f0f;
        font-size: 18px;
        margin-bottom: 5px;
    }
    
    .product-category {
        color: #7f8c8d;
        font-size: 12px;
        text-transform: uppercase;
        margin-bottom: 15px;
    }
    
    .add-to-cart-btn {
        background: #030303;
        color: white;
        border: none;
        padding: 10px 15px;
        border-radius: 4px;
        cursor: pointer;
        width: 100%;
        margin-bottom: 10px;
    }
    
    .add-to-cart-btn:hover {
        background: #c0392b;
    }
    
    .view-details {
        display: block;
        text-align: center;
        color: #3498db;
        text-decoration: none;
    }
    
    .view-details:hover {
        text-decoration: underline;
    }
    
    .no-results {
        text-align: center;
        padding: 40px 20px;
    }
    
    .categories {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-top: 20px;
    }
    
    .category-btn {
        background: #3498db;
        color: white;
        padding: 10px 20px;
        border-radius: 4px;
        text-decoration: none;
    }
    
    .category-btn:hover {
        background: #2980b9;
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Funcionalidad para añadir al carrito
        const addToCartButtons = document.querySelectorAll('.add-to-cart-btn');
        addToCartButtons.forEach(button => {
            button.addEventListener('click', function() {
                const productId = this.getAttribute('data-product-id');
                addToCart(productId);
            });
        });
        
        function addToCart(productId) {
            fetch('/add_to_cart', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    product_id: parseInt(productId),
                    quantity: 1
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification('Producto añadido al carrito', 'success');
                } else if (data.redirect) {
                    window.location.href = data.redirect;
                } else {
                    showNotification('Error: ' + data.message, 'error');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('Error de conexión', 'error');
            });
        }
        
        function showNotification(message, type) {
            // Crear notificación
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 5px;
                color: white;
                z-index: 1000;
                font-weight: bold;
            `;
            
            if (type === 'success') {
                notification.style.background = '#4CAF50';
            } else if (type === 'error') {
                notification.style.background = '#f44336';
            }
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
    });
</script>
{% endblock %}