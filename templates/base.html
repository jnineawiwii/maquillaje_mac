<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MAC Style Makeup Store</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- A침adir: cabecera fija y espacio superior para el contenido -->
  <style>
    :root { --site-header-height: 72px; } /* ajusta si tu header tiene otra altura */

    /* Fija la barra superior */
    .navbar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: var(--site-header-height);
      z-index: 1050; /* debe estar por encima del resto */
      background: linear-gradient(90deg,#040210 0%, #0b0212 100%);
      color: #fff;
      display: flex;
      align-items: center;
      gap: 18px;
      padding: 8px 20px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.25);
    }

    /* Deja espacio para la cabecera fija para que el contenido no quede debajo */
    body {
      padding-top: var(--site-header-height);
    }

    /* Ajustes internos para que el buscador y los links sigan alineados */
    .nav-brand { margin-right: 12px; font-weight:700; color:#fff; text-decoration:none; font-size:1.25rem; }
    .search-container { flex: 1 1 480px; margin: 0 20px; }
    .nav-menu { display:flex; gap:18px; align-items:center; margin-left:auto; list-style:none; padding:0; margin:0; }
    .nav-menu li { display:inline-flex; align-items:center; }
    .nav-menu a, .nav-menu span { color:#fff; text-decoration:none; padding:6px 8px; }

    /* Asegura que dropdown se muestre por encima */
    .dropdown .dropdown-content { z-index: 1100; }

    @media (max-width: 768px) {
      :root { --site-header-height: 88px; } /* si el header ocupa m치s alto en m칩vil */
      .search-container { flex-basis: 100%; max-width: none; margin: 8px 0; }
      .nav-menu { flex-wrap: wrap; justify-content:center; gap:10px; }
    }
  </style>
</head>
<body>

<!-- Skip link -->
<a class="sr-only sr-only-focusable" href="#main-content">Saltar al contenido</a>

<!-- Cabecera -->
<header>
<nav class="navbar">
    <div class="nav-brand">
        <a href="{{ url_for('index') }}" class="mac-style">MAC Style</a>
    </div>

    <!-- Buscador -->
    <div class="search-container">
        <form action="{{ url_for('search') }}" method="GET" class="search-form">
            <input type="text" name="q" placeholder="Buscar productos..." value="{{ request.args.get('q', '') }}">
            <button type="submit"><i class="fas fa-search"></i></button>
        </form>
    </div>

    <!-- Men칰 principal -->
    <ul class="nav-menu">
        {% if current_user.is_authenticated and current_user.is_admin() %}
            <li class="admin-section"><a href="{{ url_for('admin_dashboard') }}">Administraci칩n</a></li>
        {% endif %}
        <li><a href="{{ url_for('products') }}">Productos</a></li>
        <li><a href="{{ url_for('products', category='labios') }}">Labios</a></li>
        <li><a href="{{ url_for('products', category='ojos') }}">Ojos</a></li>
        <li><a href="{{ url_for('products', category='rostro') }}">Rostro</a></li>

        {% if current_user.is_authenticated %}
            <li><span>Hola, {{ current_user.username }}</span></li>
            <li><a href="{{ url_for('cart') }}" class="cart-icon">游<span class="cart-count">0</span></a></li>
        {% endif %}

        <!-- Dropdown Menu: SOLO hasta la derecha, con las 3 rayitas -->
        <li class="dropdown">
            <button class="dropdown-btn"><i class="fas fa-bars"></i></button>
            <div class="dropdown-content">
                <!-- 1. Gu칤a de usuario -->
                <a href="{{ url_for('guide') }}">Gu칤a de usuario</a>

                <!-- 2. Lector -->
                <button id="srToggleBtnMenu" class="sr-toggle">Lector</button>

                <!-- 3. Modo oscuro/claro -->
                <button id="themeToggleBtnMenu" class="theme-btn"></button>

                <!-- 4. Cerrar sesi칩n o Iniciar/Registrarse -->
                {% if current_user.is_authenticated %}
                    <a href="{{ url_for('logout') }}">Cerrar Sesi칩n</a>
                {% else %}
                    <a href="{{ url_for('login') }}">Iniciar Sesi칩n</a>
                    <a href="{{ url_for('register') }}">Registrarse</a>
                {% endif %}
            </div>
        </li>
    </ul>
</nav>
</header>

<!-- Live region para lector de pantalla -->
<div id="sr-announcer" class="sr-only" aria-live="polite" aria-atomic="true"></div>

<!-- Main -->
<main id="main-content" tabindex="-1">
    {% block content %}{% endblock %}
</main>

<footer class="site-footer">
    <p>춸 2023 MAC Style Makeup Store. Proyecto estudiantil sin derechos de autor.</p>
</footer>

<!-- Scripts -->
<script>
document.addEventListener('DOMContentLoaded', () => {
    // ===== Dropdown usuario =====
    const dropdown = document.querySelector('.dropdown');
    const dropdownBtn = dropdown.querySelector('.dropdown-btn');

    dropdownBtn.addEventListener('click', e => {
        e.stopPropagation();
        dropdown.classList.toggle('show');
    });

    document.addEventListener('click', e => {
        if(!dropdown.contains(e.target)){
            dropdown.classList.remove('show');
        }
    });

    // ===== Toggle modo oscuro/sol con texto =====
    const themeBtnMenu = document.getElementById('themeToggleBtnMenu');

    function updateThemeBtnText() {
        themeBtnMenu.textContent = document.body.classList.contains('dark-mode') ?
            'Cambiar a modo claro' :
            'Cambiar a modo oscuro';
    }

    function toggleTheme() {
        document.body.classList.toggle('dark-mode');
        localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark':'light');
        updateThemeBtnText();
    }

    // Inicializar texto seg칰n localStorage
    if(localStorage.getItem('theme') === 'dark'){
        document.body.classList.add('dark-mode');
    }
    updateThemeBtnText();
    themeBtnMenu.addEventListener('click', toggleTheme);

    // ===== Lector de pantalla =====
    let srEnabled = false;
    let srSpeechEnabled = false;
    const srToggleMenu = document.getElementById('srToggleBtnMenu');
    function srAnnounce(msg, politeness='polite'){
        const el = document.getElementById('sr-announcer');
        if(el){ el.setAttribute('aria-live', politeness); el.textContent = ''; setTimeout(()=>el.textContent=msg,100);}
        if(srSpeechEnabled && 'speechSynthesis' in window && msg){
            try{window.speechSynthesis.cancel(); const u=new SpeechSynthesisUtterance(msg); u.lang='es-ES'; window.speechSynthesis.speak(u);}catch(e){console.warn(e);}
        }
    }
    function toggleSR(){
        srEnabled = !srEnabled;
        srSpeechEnabled = srEnabled;
        srToggleMenu.classList.toggle('active', srEnabled);
        srToggleMenu.setAttribute('aria-pressed', srEnabled?'true':'false');
        srAnnounce(srEnabled ? 'Lector activado':'Lector desactivado');
    }
    srToggleMenu.addEventListener('click', toggleSR);

    // ===== Carrito efecto bump =====
    const cartCount = document.querySelector('.cart-count');
    function bumpCart(){
        cartCount.classList.add('bump');
        setTimeout(()=>cartCount.classList.remove('bump'),200);
    }

    // Simulaci칩n: agregar producto
    document.querySelectorAll('.btn-add').forEach(btn=>{
        btn.addEventListener('click', () => {
            let count = parseInt(cartCount.textContent);
            cartCount.textContent = count + 1;
            bumpCart();
        });
    });
});
</script>
</body>
</html>
