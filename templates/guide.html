<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8">
    <title>{{ title }}</title>
  </head>
  <body>
    {% extends 'base.html' %}
    {% block title %}{{ title or 'Guía - Catálogo interactivo' }}{% endblock %}

    {% block content %}
    <style>
  /* Asegurar que el viewer quede por debajo de la cabecera fija */
  .viewer { position: relative; z-index: 10; }
  .viewer-controls { z-index: 11; }

  /* Ajustes para centrar el contenido del catálogo */
.catalog-wrap { padding:28px 0; }

/* Limita el ancho y centra el contenedor principal */
.container.catalog-wrap { max-width:1100px; margin:0 auto; }

/* Centra la fila principal y fija proporciones de columnas */
.container.catalog-wrap .row { justify-content:center; align-items:flex-start; }

/* Forzar anchos más predecibles en desktop */
.container.catalog-wrap main { flex: 0 0 68%; max-width:68%; }
.container.catalog-wrap aside { flex: 0 0 30%; max-width:30%; }

/* Viewer centrado */
.viewer {
  margin: 0 auto;
  background: #fff;
  border-radius: 12px;
  /* reducir padding para que el viewer ocupe menos altura */
  padding: 16px 32px;
  box-shadow: 0 12px 34px rgba(10,10,10,0.06);
  overflow: visible;
  position: relative;
}

/* Controles fuera del viewer pero más cerca */
.viewer-controls {
  display: flex;
  justify-content: center;
  gap: 16px;
  /* menor separación y ligero empuje hacia arriba para quedar pegados al viewer sin tapar texto */
  margin-top: 8px;
  transform: translateY(-10px);
  z-index: 80;
  align-items: center;
}

/* Botones morados grandes (dentro de controls) */
.viewer-controls .nav-btn {
  background: #7b1fa2;
  color: #fff;
  border-radius: 12px;
  width: 60px;
  height: 60px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 12px 28px rgba(123,31,162,0.16);
  border: none;
  font-size: 1.25rem;
  transition: transform .12s ease, box-shadow .12s ease;
}
.viewer-controls .nav-btn:hover {
  transform: scale(1.06);
  box-shadow: 0 18px 40px rgba(123,31,162,0.22);
}

/* Mantener buen aspecto en móviles */
@media (max-width:991px){
  .viewer { padding: 14px 18px; }
  .viewer-controls { margin-top: 6px; transform: translateY(-6px); gap: 12px; }
  .viewer-controls .nav-btn { width: 52px; height: 52px; font-size: 1.05rem; }
}

/* Mantener el slider horizontal, cada paso ocupa 100% del viewer */
.viewer-inner { display:flex; transition:transform .35s ease; width:100%; }
.step-card { min-width:100%; box-sizing:border-box; padding-right:20px; display:flex; flex-direction:column; align-items:center; }

/* Media centrada */
.step-media { border-radius:10px; overflow:hidden; background:#f8f8fb; height:320px; display:flex; align-items:center; justify-content:center; width:100%; }
.step-media img { max-width:90%; max-height:100%; object-fit:contain; display:block; }

/* Meta centrada y con límite de ancho para mejor lectura */
.step-meta { padding-top:14px; max-width:820px; margin:0 auto; text-align:left; }

/* Lista de pasos (aside) centrada verticalmente */
.steps-list { display:flex; flex-direction:column; gap:12px; align-items:stretch; }

/* Miniaturas con alineación centrada visual */
.thumb {
  display:flex;
  gap:10px;
  align-items:center;
  padding:10px;
  border-radius:10px;
  background:#fff;
  border:1px solid rgba(0,0,0,0.04);
  /* desactivar interacción por clic: navegación solo con botones */
  pointer-events: none;
  opacity: 0.95;
  transition: transform .15s, box-shadow .15s, opacity .12s;
}
.thumb:hover{ transform:none; box-shadow:none; } /* quitar efecto hover porque no es clicable */
.thumb.active { border-color:#ff5a7a; box-shadow:0 18px 40px rgba(20,20,20,0.06); opacity:1; }
/* --- fin cambios thumb --- */

/* --- Mantener visual de botones (opcional) --- */
.viewer-controls .nav-btn[disabled] {
  cursor: not-allowed;
  transform: none;
  box-shadow: 0 8px 18px rgba(0,0,0,0.06);
  opacity: 0.6;
}

/* Tipografía y notas */
.step-title { font-weight:700; color:#222; font-size:0.98rem; }
.step-desc { font-size:0.88rem; color:rgba(0,0,0,0.6); }
.small-note { color:rgba(0,0,0,0.55); font-size:0.92rem; }

/* Responsive: en pantallas pequeñas apilar y ajustar anchuras */
@media (max-width:991px){
  .container.catalog-wrap main, .container.catalog-wrap aside { flex: 0 0 100%; max-width:100%; }
  .viewer-inner { min-height:520px; }
  .thumb-img { width:56px; height:44px; }
  .step-meta { text-align:left; padding:12px 4px; }
}
</style>

<div class="container catalog-wrap">
  <div class="row gx-4">
    <main class="col-lg-8 mb-4">
      <div class="viewer">
        <div class="viewer-inner" id="viewerInner">
          {# 10 pasos: 1..10 #}
          {% set steps = [
            {'title':'Introducción','desc':'Breve descripción del sitio: venta de productos de maquillaje. Propósito y ventajas para el cliente.'},
            {'title':'Navegación general','desc':'Cómo moverse por las secciones: Labios, Ojos, Rostro y promociones.'},
            {'title':'Barra de búsqueda','desc':'Escribe nombre o categoría para filtrar resultados.'},
            {'title':'Exploración de productos','desc':'Navega por secciones, filtros y ordena por precio o novedades.'},
            {'title':'Ver detalles del producto','desc':'Ficha con descripción, imágenes, precio y reseñas.'},
            {'title':'Agregar al carrito','desc':'Selecciona cantidad y pulsa "Agregar" para añadir al carrito.'},
            {'title':'Carrito de compras','desc':'Revisa items, cambia cantidades o elimina antes de pagar.'},
            {'title':'Proceso de pago (PayPal)','desc':'Instrucciones para pagar con PayPal: al seleccionar PayPal serás redirigido para completar el pago.'},
            {'title':'Revisión de pedidos','desc':'Historial y estado de pedidos disponibles en la sección "Mis pedidos".'},
            {'title':'Soporte y Cerrar sesión','desc':'Contacto de soporte, consejos y dónde está el botón de cerrar sesión.'}
          ] %}
          {% for i in range(0, steps|length) %}
            {% set idx = i + 1 %}
            {% set img = request.args.get('p' ~ idx) %}
            {% if not img %}
              {% if idx == 2 %}
                {% set img = url_for('static', filename='images/navegador.png') %}
              {% elif idx == 3 %}
                {% set img = url_for('static', filename='images/barra_busqueda.png') %}
              {% elif idx == 5 %}
                {% set img = url_for('static', filename='images/detalles.png') %}
              {% elif idx == 6 %}
                {% set img = url_for('static', filename='images/añadir_carrito.png') %}
              {% elif idx == 8 %}
                {% set img = url_for('static', filename='images/paypal.png') %}
              {% elif idx == 10 %}
                {% set img = url_for('static', filename='images/cerrar_sesion.png') %}
              {% else %}
                {% set img = None %}
              {% endif %}
            {% endif %}

            <div class="step-card" data-step="{{ idx }}">
              <div class="step-media">
                {% if img %}
                  <img src="{{ img }}" alt="Paso {{ idx }}">
                {% else %}
                  <div class="placeholder-box">
                    <div>
                      <div style="font-weight:700;">{{ steps[i].title }}</div>
                      <div style="color:rgba(0,0,0,0.55); margin-top:6px;">Pega ?p{{ idx }}=URL para ver una imagen de ejemplo.</div>
                    </div>
                  </div>
                {% endif %}
              </div>

              <div class="step-meta">
                <h4 class="mb-1">Paso {{ idx }} — {{ steps[i].title }}</h4>
                <p class="small text-muted">{{ steps[i].desc }}</p>

                {% if idx == 6 %}
                  <div class="mt-3">
                    <div class="small-note">Ejemplo del botón "Agregar":</div>
                    {# permite override vía ?add_btn=URL, si no usa la imagen estática dentro de static/images #}
                    {% set add_btn = request.args.get('add_btn') %}
                    {% if add_btn %}
                      <img src="{{ add_btn }}" alt="Botón agregar" class="preview-img mt-2" style="max-height:72px;">
                    {% else %}
                      <img src="{{ url_for('static', filename='images/añadir_carrito.png') }}" alt="Botón agregar" class="preview-img mt-2" style="max-height:72px;">
                    {% endif %}
                  </div>
                {% endif %}

                {% if idx == 8 %}
                  <div class="mt-3">
                    <h6 class="mb-1">Pago con PayPal</h6>
                    <p class="small text-muted mb-1">Al elegir PayPal serás redirigido a la pasarela segura de PayPal. Usa tu cuenta PayPal o paga con tarjeta según opciones disponibles.</p>
                    {% set paypal_img = request.args.get('paypal_img') %}
                    {% if paypal_img %}
                      <img src="{{ paypal_img }}" alt="PayPal" class="preview-img mt-2" style="max-height:72px;">
                    {% else %}
                      <img src="{{ url_for('static', filename='images/paypal.png') }}" alt="PayPal" class="preview-img mt-2" style="max-height:72px;">
                    {% endif %}
                    <p class="small text-muted mt-2">Si estás en modo sandbox, usa credenciales de prueba; en producción verifica las credenciales de PayPal en config.</p>
                  </div>
                {% endif %}

                {% if idx == 10 %}
                  <div class="mt-3">
                    <h6 class="mb-1">Cerrar sesión</h6>
                    <p class="small text-muted mb-1">El botón de cerrar sesión se encuentra en la cabecera (normalmente junto al perfil).</p>
                    {% set logout_img = request.args.get('logout_img') %}
                    {% if logout_img %}
                      <img src="{{ logout_img }}" alt="Cerrar sesión" class="preview-img mt-2" style="max-height:72px;">
                    {% else %}
                      <img src="{{ url_for('static', filename='images/cerrar_sesion.png') }}" alt="Cerrar sesión" class="preview-img mt-2" style="max-height:72px;">
                    {% endif %}
                  </div>
                {% endif %}

                <div class="mt-3 d-flex gap-2">
                  <a class="btn btn-outline-primary btn-sm" href="{{ url_for('products') }}">Ir al catálogo</a>
                  <button class="btn btn-primary btn-sm">Probar</button>
                </div>
              </div>
            </div>
          {% endfor %}
        </div>

        <div class="viewer-controls">
          <div class="nav-left">
            <button id="prevBtn" class="nav-btn" title="Anterior">&larr;</button>
          </div>
          <div class="nav-right">
            <button id="nextBtn" class="nav-btn" title="Siguiente">&rarr;</button>
          </div>
        </div>
      </div>

      <div class="mt-3">
        <small class="text-muted">Navega con flechas o haz clic en la lista de la derecha. Prueba con imágenes: <code>/guide?p1=URL&p2=URL...&add_btn=URL&paypal_img=URL&logout_img=URL</code></small>
      </div>
    </main>

    <aside class="col-lg-4">
      <div class="steps-list" id="stepsList">
        {% for i in range(0, steps|length) %}
          {% set idx = i + 1 %}
          {# thumbnail usa p# si existe, sino muestra la imagen estática para pasos concretos #}
          {% set thumb = request.args.get('p' ~ idx) %}
          {% if not thumb %}
            {% if idx == 2 %}
              {% set thumb = url_for('static', filename='images/navegador.png') %}
            {% elif idx == 3 %}
              {% set thumb = url_for('static', filename='images/barra_busqueda.png') %}
            {% elif idx == 5 %}
              {% set thumb = url_for('static', filename='images/detalles.png') %}
            {% elif idx == 6 %}
              {% set thumb = url_for('static', filename='images/añadir_carrito.png') %}
            {% elif idx == 8 %}
              {% set thumb = url_for('static', filename='images/paypal.png') %}
            {% elif idx == 10 %}
              {% set thumb = url_for('static', filename='images/cerrar_sesion.png') %}
            {% else %}
              {% set thumb = None %}
            {% endif %}
          {% endif %}

          <div class="thumb {% if idx==1 %}active{% endif %}" data-step="{{ idx }}">
            {% if thumb %}
              <img class="thumb-img" src="{{ thumb }}" alt="Thumb {{ idx }}">
            {% else %}
              <div class="thumb-img" style="display:flex;align-items:center;justify-content:center;color:rgba(0,0,0,0.35);font-weight:600;">{{ idx }}</div>
            {% endif %}
            <div>
              <div class="step-title">Paso {{ idx }} — {{ steps[i].title }}</div>
              <div class="step-desc">{{ steps[i].desc }}</div>
            </div>
          </div>
        {% endfor %}
      </div>
    </aside>
  </div>
</div>

<script>
(function(){
  const total = {{ steps|length }};
  let current = 1;
  const viewer = document.getElementById('viewerInner');
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');

  function updateViewer(index){
    index = Math.max(1, Math.min(total, index));
    current = index;
    const x = - (index - 1) * 100;
    viewer.style.transform = 'translateX(' + x + '%)';

    // actualizar clase active en miniaturas (solo visual)
    document.querySelectorAll('#stepsList .thumb').forEach(t => t.classList.remove('active'));
    const activeThumb = document.querySelector('#stepsList .thumb[data-step="' + index + '"]');
    if(activeThumb) activeThumb.classList.add('active');

    // habilitar / deshabilitar botones en los extremos
    prevBtn.disabled = (current === 1);
    nextBtn.disabled = (current === total);
  }

  // control SOLO por botones
  prevBtn.addEventListener('click', ()=> updateViewer(current - 1));
  nextBtn.addEventListener('click', ()=> updateViewer(current + 1));

  // No añadir listeners para thumbs ni teclado: navegación solo con los botones
  updateViewer(1);
})();
</script>
    {% endblock %}
  </body>
</html>